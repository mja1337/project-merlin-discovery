<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Project Merlin — Discovery Timeline</title>
  <style>
    :root{
      --grad-red:#ff0000;
      --grad-orange:#ff7a00;
      --grad-green:#1db954;
      --orange-stop:60%;
    }
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f5f5f5;color:#333;margin:0;padding:20px}
    h1{text-align:center;color:#ff0000;margin-bottom:4px}
    .sub{text-align:center;opacity:.8;margin-bottom:24px}
    .timeline-container{position:relative;margin:40px auto;max-width:1200px}
    .timeline{display:flex;justify-content:space-between;position:relative;margin-top:110px}
    .timeline-line{position:absolute;top:150px;left:0;right:0;height:4px;background:#000;z-index:0}
    .timeline-gradient{position:absolute;top:150px;left:0;right:0;height:4px;z-index:1;pointer-events:none;
      background:linear-gradient(to right,var(--grad-red) 0%,var(--grad-orange) var(--orange-stop),var(--grad-green) 100%)}
    .timeline-cover{position:absolute;top:150px;right:0;height:4px;background:#000;z-index:2;pointer-events:none}
    .gate{position:relative;text-align:center;width:120px;z-index:3;font-weight:600}
    .gate.completed{color:#1db954}
    .gate.current{color:#ff7a00}
    .gate small{display:block;font-weight:400;opacity:.75;margin-top:2px}
    .gate:hover .tooltip{visibility:visible;opacity:1}
    .tooltip{visibility:hidden;background:#333;color:#fff;text-align:left;border-radius:8px;padding:10px 12px;position:absolute;bottom:10px;left:50%;
      transform:translateX(-50%);opacity:0;transition:opacity .25s;z-index:5;width:300px;box-shadow:0 8px 20px rgba(0,0,0,.25)}
    .tooltip b{display:block;margin-bottom:6px}
    .tooltip ul{margin:0;padding-left:18px}

    /* Hide the old mid-week dots; we’ll render true week-start ticks instead */
    .gate .dot{display:none}

    /* Rocket + tooltip */
    #merlin{position:absolute;top:60px;transition:left .5s;z-index:6}
    #merlin:hover + .merlin-tooltip{visibility:visible;opacity:1}
    .merlin-tooltip{visibility:hidden;background:#000;color:#fff;text-align:left;border-radius:8px;padding:10px 12px;position:absolute;top:160px;left:50%;
      transform:translateX(-50%);opacity:0;transition:opacity .25s;z-index:7;width:320px;box-shadow:0 8px 20px rgba(0,0,0,.35)}

    /* Week-start ticks, aligned to the exact start of each week */
    .ticks{position:absolute;top:142px;left:0;right:0;height:16px;z-index:4}
    .ticks .tick{
      position:absolute;top:0;width:16px;height:16px;border-radius:50%;
      background:#ff0000;transform:translateX(-50%);
    }

    /* Xmas band */
    .holiday-band{position:absolute;top:140px;height:10px;background:rgba(255,0,0,.12);border:1px dashed rgba(255,0,0,.6);z-index:2;display:none}
    .holiday-band .label{position:absolute;top:-22px;left:50%;transform:translateX(-50%);font-size:12px;background:#fff;padding:2px 6px;border-radius:6px;border:1px solid rgba(255,0,0,.6)}
  </style>
</head>
<body>
  <h1>Project Merlin — Discovery Timeline</h1>
  <div class="sub">Weekly milestones from 29 Oct 2025 to 09 Mar 2026 (Discovery only)</div>

  <div class="timeline-container">
    <img id="merlin" src="https://github.com/mja1337/project-merlin-discovery/blob/main/merlin_rocket.png?raw=true" width="150" height="100" alt="Merlin Rocket"/>
    <div class="merlin-tooltip" id="merlinTooltip"></div>

    <div class="timeline-line"></div>
    <div class="timeline-gradient"></div>
    <div class="timeline-cover" id="timelineCover"></div>

    <!-- Week-start ticks -->
    <div class="ticks" id="ticks"></div>

    <!-- Xmas highlight band gets sized/placed by JS -->
    <div class="holiday-band" id="xmasBand">
      <div class="label">Christmas & New Year</div>
    </div>

    <div class="timeline" id="timeline">
      <div class="gate">
        Week 1
        <small>27 Oct 2025 – 02 Nov 2025</small>
        <div class="tooltip">
          <b>Kickoff + R2R 1–2</b>
          <ul>
            <li>29 Oct 2025: Introductory Session</li>
            <li>30 Oct 2025: Record to Report 1</li>
            <li>31 Oct 2025: Record to Report 2</li>
          </ul>
        </div>
      </div>

      <div class="gate">
        Week 2
        <small>03 Nov 2025 – 09 Nov 2025</small>
        <div class="tooltip">
          <b>Finance: R2R 3–5</b>
          <ul>
            <li>04 Nov 2025: Record to Report 3</li>
            <li>05 Nov 2025: Record to Report 4</li>
            <li>07 Nov 2025: Record to Report 5</li>
          </ul>
        </div>
      </div>

      <div class="gate">
        Week 3
        <small>10 Nov 2025 – 16 Nov 2025</small>
        <div class="tooltip">
          <b>P2P 1–3</b>
          <ul>
            <li>11 Nov 2025: Procure to Pay 1</li>
            <li>13 Nov 2025: Procure to Pay 2</li>
            <li>14 Nov 2025: Procure to Pay 3</li>
          </ul>
        </div>
      </div>

      <div class="gate">
        Week 4
        <small>17 Nov 2025 – 23 Nov 2025</small>
        <div class="tooltip">
          <b>P2P 4 + Fixed Assets</b>
          <ul>
            <li>18 Nov 2025: Procure to Pay 4 - RTM Review</li>
            <li>20 Nov 2025: Fixed Assets</li>
          </ul>
        </div>
      </div>

      <div class="gate">
        Week 5
        <small>24 Nov 2025 – 30 Nov 2025</small>
        <div class="tooltip">
          <b>Operations: D2B 1–4</b>
          <ul>
            <li>25 Nov 2025: Design to Build 1</li>
            <li>26 Nov 2025: Design to Build/WMS 2</li>
            <li>27 Nov 2025: Design to Build 3</li>
            <li>28 Nov 2025: Design to Build 4 - RTM Review</li>
          </ul>
        </div>
      </div>

      <div class="gate">
        Week 6
        <small>01 Dec 2025 – 07 Dec 2025</small>
        <div class="tooltip">
          <b>O2C 1–3 + D2B 5</b>
          <ul>
            <li>02 Dec 2025: Customers + Order to Cash 1 (CCO)</li>
            <li>03 Dec 2025: Customers + Order to Cash 2 (CS/AD)</li>
            <li>04 Dec 2025: Customers + Order to Cash 3 (CARE)</li>
            <li>05 Dec 2025: Design to Build 5 - RTM Review</li>
          </ul>
        </div>
      </div>

      <!-- NEW WEEK 7 -->
      <div class="gate">
        Week 7
        <small>08 Dec 2025 – 14 Dec 2025</small>
        <div class="tooltip">
          <b>Design to Build 6</b>
          <ul>
            <li>10 Dec 2025: Design to Build 6 - RTM Review 2</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 7 -> Week 8 -->
      <div class="gate">
        Week 8
        <small>15 Dec 2025 – 21 Dec 2025</small>
        <div class="tooltip">
          <b>Lead to Quote 1–2</b>
          <ul>
            <li>16 Dec 2025: Lead to Quote 1 - Marketing</li>
            <li>17 Dec 2025: Lead to Quote 2 - IQ/Eagle</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 8 -> Week 9 -->
      <div class="gate">
        Week 9
        <small>12 Jan 2026 – 18 Jan 2026</small>
        <div class="tooltip">
          <b>Field Service 1–4 (incl. Cases)</b>
          <ul>
            <li>12 Jan 2026: Field Service 1</li>
            <li>13 Jan 2026: Field Service 2</li>
            <li>14 Jan 2026: Field Service 3 - Cases</li>
            <li>15 Jan 2026: Field Service 4</li>
            <li>16 Jan 2026: Integrations 1</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 9 -> Week 10 -->
      <div class="gate">
        Week 10
        <small>19 Jan 2026 – 25 Jan 2026</small>
        <div class="tooltip">
          <b>Integrations 2–3 + Data Migration 1–2</b>
          <ul>
            <li>19 Jan 2026: Integrations 2</li>
            <li>20 Jan 2026: Integrations 3</li>
            <li>21 Jan 2026: Data Migration 1</li>
            <li>22 Jan 2026: Data Migration 2</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 10 -> Week 11 -->
      <div class="gate">
        Week 11
        <small>02 Feb 2026 – 08 Feb 2026</small>
        <div class="tooltip">
          <b>Billing & Revenue 1–5 (ARM, ZAB, GT)</b>
          <ul>
            <li>02 Feb 2026: Billing and Revenue 1 - ARM & ZAB Questionnaire</li>
            <li>03 Feb 2026: Billing and Revenue 2 - ZAB Essentials</li>
            <li>04 Feb 2026: Billing and Revenue 3 - ZAB API - Approvals</li>
            <li>05 Feb 2026: Billing & Revenue 4 - ARM High level req - Review findings</li>
            <li>06 Feb 2026: Billing & Revenue 5 - Deep dive Use case 1</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 11 -> Week 12 -->
      <div class="gate">
        Week 12
        <small>09 Feb 2026 – 15 Feb 2026</small>
        <div class="tooltip">
          <b>Billing & Revenue 6–9 (ARM, ZAB, GT)</b>
          <ul>
            <li>10 Feb 2026: Billing & Revenue 6 - Grant Thornton - Session 1</li>
            <li>11 Feb 2026: Billing & Revenue 7 - Deep dive Use case 2</li>
            <li>12 Feb 2026: Billing & Revenue 8 - Grant Thornton - Session 2</li>
            <li>13 Feb 2026: Billing & Revenue 9 - Deep dive Use case 3</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 12 -> Week 13 -->
      <div class="gate">
        Week 13
        <small>16 Feb 2026 – 22 Feb 2026</small>
        <div class="tooltip">
          <b>Billing & Revenue 10–12 (ARM, ZAB, GT)</b>
          <ul>
            <li>16 Feb 2026: Billing & Revenue 10 - Deep dive Use case 4</li>
            <li>18 Feb 2026: Billing & Revenue 11 - Deep dive Use case 5</li>
            <li>20 Feb 2026: Billing & Revenue 12 -  2nd Review of Findings</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 13 -> Week 14 -->
      <div class="gate">
        Week 14
        <small>23 Feb 2026 – 01 Mar 2026</small>
        <div class="tooltip">
          <b>Onsite BRD reviews</b>
          <ul>
            <li>26 Feb 2026: On site review BRD with Team 1</li>
            <li>27 Feb 2026: On site review BRD with Team 2</li>
          </ul>
        </div>
      </div>

      <!-- Old Week 14 -> Week 15 -->
      <div class="gate">
        Week 15
        <small>09 Mar 2026 – 15 Mar 2026</small>
        <div class="tooltip">
          <b>BRD finish & onsite reviews</b>
          <ul>
            <li>09 Mar 2026: Final BRD agreement and adjustment to plan and commercials.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Weekly boundaries for positioning
    const weekStarts = [
      new Date('2025-10-27'), // Week 1
      new Date('2025-11-03'), // Week 2
      new Date('2025-11-10'), // Week 3
      new Date('2025-11-17'), // Week 4
      new Date('2025-11-24'), // Week 5
      new Date('2025-12-01'), // Week 6
      new Date('2025-12-08'), // Week 7 (D2B 6 - RTM Review 2)
      new Date('2025-12-15'), // Week 8 (Lead to Quote)
      new Date('2026-01-12'), // Week 9 (Field Service)
      new Date('2026-01-19'), // Week 10 (Integrations / Data Migration)
      new Date('2026-02-02'), // Week 11 (Billing & Revenue 1–5)
      new Date('2026-02-09'), // Week 12 (Billing & Revenue 6–9)
      new Date('2026-02-16'), // Week 13 (Billing & Revenue 10–12)
      new Date('2026-02-23'), // Week 14 (Onsite BRD reviews)
      new Date('2026-03-09')  // Week 15 (BRD finish & onsite reviews)
    ];
    const weekEnds   = [
      new Date('2025-11-02'), // Week 1
      new Date('2025-11-09'), // Week 2
      new Date('2025-11-16'), // Week 3
      new Date('2025-11-23'), // Week 4
      new Date('2025-11-30'), // Week 5
      new Date('2025-12-07'), // Week 6
      new Date('2025-12-14'), // Week 7
      new Date('2025-12-21'), // Week 8
      new Date('2026-01-18'), // Week 9
      new Date('2026-01-25'), // Week 10
      new Date('2026-02-08'), // Week 11
      new Date('2026-02-15'), // Week 12
      new Date('2026-02-22'), // Week 13
      new Date('2026-03-01'), // Week 14
      new Date('2026-03-15')  // Week 15
    ];

    const xmasStart = new Date('2025-12-23');
    const xmasEnd   = new Date('2026-01-05');

    const gates = document.querySelectorAll('.gate');
    const merlin = document.getElementById('merlin');
    const merlinTooltip = document.getElementById('merlinTooltip');
    const cover = document.getElementById('timelineCover');
    const timeline = document.getElementById('timeline');
    const xmasBand = document.getElementById('xmasBand');
    const ticksEl = document.getElementById('ticks');

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    // Map a progress value (0..n-1) to a left pixel, using the timeline width.
    function leftForIndex(progress){
      const fraction = clamp(progress/(gates.length-1), 0, 1);
      return (fraction * timeline.offsetWidth) - (merlin.offsetWidth/2);
    }

    function fractionForDate(d){
      const total = gates.length;
      if (d <= weekStarts[0]) return 0;
      if (d >= weekEnds[total-1]) return total-1;
      for (let i=0;i<total;i++){
        if (d >= weekStarts[i] && d <= weekEnds[i]){
          // Fraction within week i
          const span = (weekEnds[i] - weekStarts[i]);
          const done = (d - weekStarts[i]);
          const frac = span > 0 ? (done / span) : 0;
          return i + frac;
        }
        if (d < weekStarts[i]){
          const prevEnd = weekEnds[i-1];
          const span = (weekStarts[i] - prevEnd);
          const done = (d - prevEnd);
          return (i-1) + (span > 0 ? done/span : 0);
        }
      }
      return total-1;
    }

    function updateMerlinPosition(progress){
      merlin.style.left = leftForIndex(progress) + 'px';
      const idx = clamp(Math.floor(progress),0,gates.length-1);

      // Reset classes, then set completed/current
      gates.forEach((g,i)=>{
        g.classList.remove('completed','current');
        if (i < idx) g.classList.add('completed');
        else if (i === idx) g.classList.add('current');
      });

      const tip = gates[idx].querySelector('.tooltip').innerHTML;
      merlinTooltip.innerHTML = `<strong>Current Week:</strong><br>${tip}`;
    }

    function updateCover(progress){
      const fraction = clamp(progress/(gates.length-1),0,1);
      const pct = (fraction*100).toFixed(4);
      cover.style.left = pct+'%';
      cover.style.width = (100 - pct)+'%';
    }

    // Build week-start ticks at exact 0%, 1/(n-1), …, 100%
    function buildTicks(){
      const total = gates.length;
      ticksEl.innerHTML = '';
      for (let i = 0; i < total; i++){
        const pct = (i/(total-1))*100;
        const el = document.createElement('div');
        el.className = 'tick';
        el.style.left = pct + '%';
        ticksEl.appendChild(el);
      }
    }

    function placeXmasBand(){
      const total = gates.length;
      const width = timeline.offsetWidth;

      const startFrac = fractionForDate(xmasStart); // 0..(n-1) with decimals
      const endFrac   = fractionForDate(xmasEnd);

      const step = width/(total-1);
      const leftPx = step * startFrac;
      const rightPx = step * endFrac;
      const bandWidth = Math.max(12, rightPx - leftPx);

      xmasBand.style.left = leftPx + 'px';
      xmasBand.style.width = bandWidth + 'px';
      xmasBand.style.display = 'block';
    }

    function computeProgressToday(){
      const today = new Date();
      return fractionForDate(today);
    }

    function updateAll(){
      const progress = computeProgressToday();
      buildTicks();
      updateMerlinPosition(progress);
      updateCover(progress);
      placeXmasBand();
    }

    updateAll();
    window.addEventListener('resize', updateAll);
  </script>
</body>
</html>
